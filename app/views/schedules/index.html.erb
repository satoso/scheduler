<ul class="pager">
  <li><%= link_to 'Prev',  root_path + @date_prev.strftime('%Y%m') %></li>
  <li><%= link_to 'Today', root_path %></li>
  <li><%= link_to 'Next',  root_path + @date_next.strftime('%Y%m') %></li>
</ul>
<table class="table table-bordered">
  <tr>
    <th>日付</th>
    <th>曜日</th>
    <th>時間</th>
    <% @members.each do |m| %>
      <th><%= link_to m.name, edit_member_schedules_path(m, yyyymm: @date_here.strftime('%Y%m')) %></th>
    <% end %>
    <th>メモ</th>
  </tr>

  <% @days.each do |d| %>
    <% Schedule.times.keys.each_with_index do |t, t_idx| %>
      <tr>
        <% if t_idx.zero? %>
          <td rowspan="<%= Schedule.times.count %>"><%= d.strftime('%Y') %><br><%= d.strftime('%m/%d') %></td>
          <td rowspan="<%= Schedule.times.count %>"><%= weekday_name(d) %></td>
        <% end %>

        <td><%= time_name(t) %></td>

        <% @members.each do |m| %>
          <td><%= find_schedule_availability(@schedules, d, t, m.id) %></td>
        <% end %>

        <td>
          <% build_notes(@schedules, d, t, @members).each do |n| %>
            <p><%= n[:note] %>(<%= n[:member] %>)</p>
          <% end %>
        </td>
      </tr>
    <% end %>
  <% end %>
</table>
